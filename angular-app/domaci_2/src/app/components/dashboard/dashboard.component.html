<div class="dashboard-container">
  <h2>Your Accounts</h2>

  <div *ngIf="errorMessage" class="error-message">{{ errorMessage }}</div>
  <div *ngIf="successMessage" class="success-message">{{ successMessage }}</div>

  <app-button label="Add Account" type="primary" [routerLink]="['/add-account']">Add Account</app-button>

  <div class="top-section">
    <div class="account-list" style="padding-top: 30px;">
      <ng-container *ngIf="!isLoadingAccounts; else loadingAccounts">
        <ng-container *ngIf="accounts?.length; else noAccounts">
          <div *ngFor="let account of accounts; trackBy: trackByAccountId">

            <div class="account-card">
              <div class="account-header">
                <h3>{{ account.name || account.account_name }}</h3>
                <span class="material-icons" (click)="deleteAccount(account.id)">delete</span>
              </div>
              <p [ngStyle]="{ color: account.balance < '0' ? 'red' : 'inherit' }">
                Balance: {{ account.balance | currencyFormat:'RSD' }}
              </p>
              <app-button label="View Transactions" type="secondary" (onClick)="viewDetails(account.id)">
                View Transactions
              </app-button>
            </div>


          </div>
        </ng-container>
      </ng-container>
      <ng-template #loadingAccounts>
        <p>Loading accounts...</p>
      </ng-template>
      <ng-template #noAccounts>
        <p>You don't have any accounts yet.</p>
      </ng-template>
    </div>

    <div class="calculator">
      <h3>Savings Calculator</h3>
      <form (ngSubmit)="calculateSavings()" #savingsForm="ngForm" class="calculator-form">
        <label>Initial Amount (RSD):</label>
        <input type="number" [(ngModel)]="initialAmount" name="initialAmount" required />
        <label>Monthly Contribution (RSD):</label>
        <input type="number" [(ngModel)]="monthlyContribution" name="monthlyContribution" required />
        <label>Number of Months:</label>
        <input type="number" [(ngModel)]="months" name="months" required />
        <label>Annual Interest Rate (%):</label>
        <input type="number" [(ngModel)]="interestRate" name="interestRate" />
        <label>Display in Currency:</label>
        <select [(ngModel)]="selectedCurrency" name="selectedCurrency">
          <option value="EUR">EUR</option>
          <option value="USD">USD</option>
          <option value="CHF">CHF</option>
        </select>
        <app-button label="Calculate" type="primary">Calculate</app-button>
      </form>
      <div *ngIf="savingsTotal !== null">
        <strong>Total Savings in RSD:</strong>
        <p class="savings-result">{{ savingsTotal | number:'1.2-2' }} RSD</p>
      </div>
      <div *ngIf="convertedCurrency !== null">
        <strong>In {{ selectedCurrency }}:</strong>
        <p class="currency-result">{{ convertedCurrency | number:'1.2-2' }} {{ selectedCurrency }}</p>
      </div>
    </div>
  </div>

  <div class="charts-container">
    <div class="chart-card">
      <h3>Spendings and Savings</h3>
      <canvas baseChart [data]="pieChartData" [type]="'pie'" [options]="pieChartOptions"
        style="flex-grow: 1; width: 100%;"></canvas>
    </div>
    <div class="chart-card">
      <h3>Monthly Spending</h3>
      <canvas baseChart [data]="barChartData" [type]="'bar'" [options]="barChartOptions"
        style="flex-grow: 1; width: 100%;"></canvas>
    </div>
  </div>

  <div class="activity-feed">
    <h3>Recent Transactions</h3>
    <ul>
      <li *ngFor="let tx of recentTransactionsLimited">
        <strong>{{ tx.account.name || tx.account.account_name || 'No Account' }} </strong>
        <span [ngStyle]="{'color': tx.type === 'expense' ? 'red' : 'inherit'}">
          {{ tx.type === 'income' ? '+' : '-' }}
          {{ tx.amount | currencyFormat:'RSD' }}
        </span>
        <span style="float: right; font-style: italic">
          {{ tx.created_at | date:'mediumDate' }}
        </span>
      </li>
      <li *ngIf="!recentTransactions.length">No recent transactions</li>
    </ul>
  </div>
</div>